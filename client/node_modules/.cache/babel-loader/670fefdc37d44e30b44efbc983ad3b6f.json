{"ast":null,"code":"var _jsxFileName = \"/Users/quangnguyen/Desktop/Projects/Chazzy/client/src/components/Dashboard.js\";\nimport React, { useState, useEffect } from 'react';\nimport { navigate } from '@reach/router';\nimport axios from 'axios';\nimport Context from '../Context';\nimport io from 'socket.io-client'; // Components\n\nimport UserProfilePreview from '../components/UserProfilePreview';\nimport ChatArea from '../components/ChatArea'; // Bootstrap & Images\n\nimport { Navbar, Nav, Row, Col, Badge } from 'react-bootstrap';\nimport styles from './Dashboard.module.css';\nimport '../App.css';\nimport Grey from '../grey.jpg';\n\nconst Dashboard = () => {\n  const [socket] = useState(() => io(':8000'));\n  const [chatUser, setChatUser] = useState(null);\n  const [newMessage, setNewMessage] = useState(null); // Get from first load\n\n  const [loggedInUser, setLoggedInUser] = useState(null);\n  const [otherUsers, setOtherUsers] = useState([]);\n  const [groupedMessages, setGroupedMessages] = useState({}); // GET USERS & LOGGED IN USER\n\n  useEffect(() => {\n    axios.get('http://localhost:8000/api/users', {\n      withCredentials: true\n    }).then(res => {\n      setLoggedInUser(res.data.loggedInUser);\n      setOtherUsers(res.data.otherUsers);\n      setGroupedMessages(res.data.groupedMessages);\n    }).catch(err => navigate('/welcome'));\n  }, []);\n  useEffect(() => {\n    socket.on('received-newMessage', data => setNewMessage(data.message));\n  }, [loggedInUser]);\n  useEffect(() => {\n    if (newMessage) {\n      const repUserID = newMessage.senderID === loggedInUser._id ? newMessage.receiverID : newMessage.senderID;\n      const appendingMessage = groupedMessages.hasOwnProperty(repUserID) ? groupedMessages[repUserID].concat([newMessage]) : [newMessage];\n      setGroupedMessages({ ...groupedMessages,\n        [repUserID]: appendingMessage\n      });\n      setNewMessage(null);\n    }\n  }, [newMessage]);\n\n  const logOut = () => {\n    navigate('/');\n    axios.get('http://localhost:8000/api/users/logout', {\n      withCredentials: true\n    }).then(res => {\n      /* TODO: Do something with res */\n    }).catch(err => {\n      /* TODO: Do something with err */\n    });\n  };\n\n  const getRepresentationalUser = message => getUserById(message.receiverID === loggedInUser._id ? message.senderID : message.receiverID);\n\n  const getUserById = userID => otherUsers.filter(user => user._id === userID)[0];\n\n  const displayTimeAgo = timestamp => {\n    const date = new Date(timestamp);\n\n    const moment = require('moment')(date);\n\n    return moment.fromNow();\n  };\n\n  const ConversationsListDisplay = () => {\n    return React.createElement(\"li\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 69\n      },\n      __self: this\n    }, Object.entries(groupedMessages).map((grouped, idx) => React.createElement(\"ul\", {\n      onClick: () => setChatUser(getUserById(grouped[0])),\n      key: idx,\n      className: \"btn btn-light list-inline my-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71\n      },\n      __self: this\n    }, React.createElement(\"li\", {\n      className: \"list-inline-item align-middle\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 72\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      width: \"75\",\n      height: \"75\",\n      className: \"rounded-circle\",\n      src: Grey,\n      alt: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73\n      },\n      __self: this\n    })), React.createElement(\"li\", {\n      className: \"list-inline-item align-middle ml-2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75\n      },\n      __self: this\n    }, React.createElement(\"h6\", {\n      className: \"m-0 font-weight-bold\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76\n      },\n      __self: this\n    }, getUserById(grouped[0]).username), React.createElement(\"p\", {\n      className: \"m-0 text-secondary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77\n      },\n      __self: this\n    }, grouped[1][grouped[1].length - 1].senderID !== loggedInUser._id ? `${getUserById(grouped[0]).firstName} sent you a message` : grouped[1][grouped[1].length - 1].message)), React.createElement(\"li\", {\n      className: \"list-inline-item align-middle float-right text-right py-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 81\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      className: \"m-0 text-secondary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, React.createElement(\"small\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, displayTimeAgo(grouped[1][grouped[1].length - 1].createdAt))), React.createElement(\"h5\", {\n      className: \"m-0 text-secondary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, React.createElement(Badge, {\n      variant: \"light\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, grouped[1][grouped[1].length - 1].senderID === loggedInUser._id ? 'Sent' : 'Received'))))));\n  };\n\n  return React.createElement(\"div\", {\n    className: `${styles.dashboard}`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92\n    },\n    __self: this\n  }, React.createElement(Navbar, {\n    style: {\n      backgroundColor: 'white',\n      zIndex: '5'\n    },\n    className: \"shadow-sm px-4\",\n    expand: \"md\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }, React.createElement(\"h3\", {\n    className: \"p-0 m-0 font-weight-bold\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, \"Chazzy.\"), React.createElement(Navbar.Toggle, {\n    \"aria-controls\": \"nav-collapse\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }), React.createElement(Navbar.Collapse, {\n    id: \"nav-collapse\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, React.createElement(Nav, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, React.createElement(\"h5\", {\n    className: \"nav-link align-middle m-0 ml-3\",\n    href: \"#\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }, loggedInUser ? React.createElement(Badge, {\n    className: \"p-2\",\n    variant: \"dark\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }, \"@\", loggedInUser.username) : React.createElement(React.Fragment, null))), React.createElement(Nav, {\n    className: \"ml-auto m-0 p-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  }, React.createElement(Nav.Link, {\n    onClick: logOut,\n    href: \"#\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101\n    },\n    __self: this\n  }, \"Log Out.\")))), React.createElement(\"div\", {\n    className: `${styles.rowHeight} container-fluid m-0 p-0 w-100`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105\n    },\n    __self: this\n  }, React.createElement(Row, {\n    className: \"h-100 w-100 p-0 m-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, React.createElement(Col, {\n    style: {\n      borderRight: '0.5px solid rgb(245, 245, 245)'\n    },\n    className: `h-100 w-100 overflow-auto ${styles.left}`,\n    md: 5,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, React.createElement(\"ul\", {\n    className: \"list-inline w-100 text-left pt-4 m-0\",\n    style: {\n      overflowX: 'scroll'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }, otherUsers.map(otherUser => React.createElement(\"li\", {\n    key: otherUser._id,\n    className: \"list-inline-item mx-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }, React.createElement(UserProfilePreview, {\n    onClick: () => setChatUser(otherUser),\n    user: otherUser,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  })))), React.createElement(\"ul\", {\n    className: \"list-inline w-100 px-3 py-4 m-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116\n    },\n    __self: this\n  }, React.createElement(\"h5\", {\n    className: \"mx-auto mb-4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }, \"Hi \", loggedInUser ? loggedInUser.firstName : '', \"! You have (\", Object.keys(groupedMessages).length, \") conversations.\")), React.createElement(\"li\", {\n    className: \"w-100 text-left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }, React.createElement(\"ul\", {\n    className: \"list-inline\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, ConversationsListDisplay())))), React.createElement(Col, {\n    className: `p-3 h-100 ${styles.right}`,\n    md: 7,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, React.createElement(Context.Provider, {\n    value: {\n      loggedInUser\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127\n    },\n    __self: this\n  }, chatUser ? React.createElement(ChatArea, {\n    userWhomAmChattingWith: chatUser,\n    passedInMessages: groupedMessages[chatUser._id],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }) : React.createElement(React.Fragment, null))))));\n};\n\nexport default Dashboard;","map":{"version":3,"sources":["/Users/quangnguyen/Desktop/Projects/Chazzy/client/src/components/Dashboard.js"],"names":["React","useState","useEffect","navigate","axios","Context","io","UserProfilePreview","ChatArea","Navbar","Nav","Row","Col","Badge","styles","Grey","Dashboard","socket","chatUser","setChatUser","newMessage","setNewMessage","loggedInUser","setLoggedInUser","otherUsers","setOtherUsers","groupedMessages","setGroupedMessages","get","withCredentials","then","res","data","catch","err","on","message","repUserID","senderID","_id","receiverID","appendingMessage","hasOwnProperty","concat","logOut","getRepresentationalUser","getUserById","userID","filter","user","displayTimeAgo","timestamp","date","Date","moment","require","fromNow","ConversationsListDisplay","Object","entries","map","grouped","idx","username","length","firstName","createdAt","dashboard","backgroundColor","zIndex","rowHeight","borderRight","left","overflowX","otherUser","keys","right"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { navigate } from '@reach/router';\nimport axios from 'axios';\nimport Context from '../Context';\nimport io from 'socket.io-client';\n\n// Components\nimport UserProfilePreview from '../components/UserProfilePreview';\nimport ChatArea from '../components/ChatArea';\n\n// Bootstrap & Images\nimport { Navbar, Nav, Row, Col, Badge } from 'react-bootstrap';\nimport styles from './Dashboard.module.css';\nimport '../App.css';\nimport Grey from '../grey.jpg';\n\nconst Dashboard = () => {\n    const [socket] = useState(() => io(':8000'));\n    const [chatUser, setChatUser] = useState(null);\n    const [newMessage, setNewMessage] = useState(null);\n\n    // Get from first load\n    const [loggedInUser, setLoggedInUser] = useState(null);\n    const [otherUsers, setOtherUsers] = useState([]);\n    const [groupedMessages, setGroupedMessages] = useState({});\n\n    // GET USERS & LOGGED IN USER\n    useEffect(() => {\n        axios.get('http://localhost:8000/api/users', { withCredentials: true })\n            .then(res => {\n                setLoggedInUser(res.data.loggedInUser);\n                setOtherUsers(res.data.otherUsers);\n                setGroupedMessages(res.data.groupedMessages);\n            })\n            .catch(err => navigate('/welcome'));\n    }, []);\n\n    useEffect(() => {\n        socket.on('received-newMessage', data => setNewMessage(data.message));\n    }, [loggedInUser]);\n\n    useEffect(() => {\n        if (newMessage) {\n            const repUserID = (newMessage.senderID === loggedInUser._id) ? newMessage.receiverID : newMessage.senderID;\n            const appendingMessage = (groupedMessages.hasOwnProperty(repUserID)) ? groupedMessages[repUserID].concat([newMessage]) : [newMessage];\n            setGroupedMessages({ ...groupedMessages, [repUserID]: appendingMessage });\n            setNewMessage(null);\n        }\n    }, [newMessage]);\n\n    const logOut = () => {\n        navigate('/');\n        axios.get('http://localhost:8000/api/users/logout', { withCredentials: true })\n            .then(res => { /* TODO: Do something with res */ })\n            .catch(err => { /* TODO: Do something with err */ });\n    }\n\n    const getRepresentationalUser = message => getUserById((message.receiverID === loggedInUser._id) ? message.senderID : message.receiverID);\n    const getUserById = userID => otherUsers.filter(user => user._id === userID)[0];\n\n    const displayTimeAgo = timestamp => {\n        const date = new Date(timestamp);\n        const moment = require('moment')(date);\n        return moment.fromNow();\n    }\n\n    const ConversationsListDisplay = () => {\n        return (\n            <li>\n                {Object.entries(groupedMessages).map((grouped, idx) => (\n                    <ul onClick={() => setChatUser(getUserById(grouped[0]))} key={idx} className=\"btn btn-light list-inline my-3\">\n                        <li className=\"list-inline-item align-middle\">\n                            <img width=\"75\" height=\"75\" className=\"rounded-circle\" src={Grey} alt=\"\" /><br />\n                        </li>\n                        <li className=\"list-inline-item align-middle ml-2\">\n                            <h6 className=\"m-0 font-weight-bold\">{getUserById(grouped[0]).username}</h6>\n                            <p className=\"m-0 text-secondary\">\n                                {(grouped[1][grouped[1].length - 1].senderID !== loggedInUser._id) ? `${getUserById(grouped[0]).firstName} sent you a message` : grouped[1][grouped[1].length - 1].message}\n                            </p>\n                        </li>\n                        <li className=\"list-inline-item align-middle float-right text-right py-3\">\n                            <p className=\"m-0 text-secondary\"><small>{displayTimeAgo(grouped[1][grouped[1].length - 1].createdAt)}</small></p>\n                            <h5 className=\"m-0 text-secondary\"><Badge variant=\"light\">{grouped[1][grouped[1].length - 1].senderID === loggedInUser._id ? 'Sent' : 'Received'}</Badge></h5>\n                        </li>\n                    </ul>\n                ))}\n            </li>\n        );\n    }\n\n    return (\n        <div className={`${styles.dashboard}`}>\n            <Navbar style={{ backgroundColor: 'white', zIndex: '5' }} className=\"shadow-sm px-4\" expand=\"md\">\n                <h3 className=\"p-0 m-0 font-weight-bold\">Chazzy.</h3>\n                <Navbar.Toggle aria-controls=\"nav-collapse\" />\n                <Navbar.Collapse id=\"nav-collapse\">\n                    <Nav>\n                        <h5 className=\"nav-link align-middle m-0 ml-3\" href=\"#\">{loggedInUser ? <Badge className=\"p-2\" variant=\"dark\">@{loggedInUser.username}</Badge> : <></>}</h5>\n                    </Nav>\n                    <Nav className=\"ml-auto m-0 p-0\">\n                        <Nav.Link onClick={logOut} href=\"#\">Log Out.</Nav.Link>\n                    </Nav>\n                </Navbar.Collapse>\n            </Navbar>\n            <div className={`${styles.rowHeight} container-fluid m-0 p-0 w-100`}>\n                <Row className=\"h-100 w-100 p-0 m-0\">\n                    <Col style={{ borderRight: '0.5px solid rgb(245, 245, 245)' }} className={`h-100 w-100 overflow-auto ${styles.left}`} md={5}>\n                        <ul className=\"list-inline w-100 text-left pt-4 m-0\" style={{ overflowX: 'scroll' }}>\n                            {otherUsers.map(otherUser => (\n                                <li key={otherUser._id} className=\"list-inline-item mx-2\">\n                                    <UserProfilePreview onClick={() => setChatUser(otherUser)} user={otherUser} />\n                                </li>\n                            ))}\n                        </ul>\n                        <ul className=\"list-inline w-100 px-3 py-4 m-0\">\n                            <li>\n                                <h5 className=\"mx-auto mb-4\">Hi {loggedInUser ? loggedInUser.firstName : ''}! You have ({Object.keys(groupedMessages).length}) conversations.</h5>\n                            </li>\n                            <li className=\"w-100 text-left\">\n                                <ul className=\"list-inline\">\n                                    {ConversationsListDisplay()}\n                                </ul>\n                            </li>\n                        </ul>\n                    </Col>\n                    <Col className={`p-3 h-100 ${styles.right}`} md={7}>\n                        <Context.Provider value={{ loggedInUser }}>\n                            {chatUser ? <ChatArea userWhomAmChattingWith={chatUser} passedInMessages={groupedMessages[chatUser._id]} /> : <></>}\n                        </Context.Provider>\n                    </Col>\n                </Row>\n            </div>\n        </div >\n    )\n}\n\nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}