{"ast":null,"code":"var _jsxFileName = \"/Users/quangnguyen/Desktop/Projects/Chazzy/client/src/components/Dashboard.js\";\nimport React, { useState, useEffect, useContext } from 'react';\nimport { navigate } from '@reach/router';\nimport axios from 'axios';\nimport Context from '../Context';\nimport io from 'socket.io-client'; // Components\n\nimport UserProfilePreview from '../components/UserProfilePreview';\nimport ChatArea from '../components/ChatArea'; // Bootstrap & Images\n\nimport { Navbar, Nav, Row, Col } from 'react-bootstrap';\nimport styles from './Dashboard.module.css';\nimport '../App.css';\nimport Grey from '../grey.jpg';\n\nconst Dashboard = () => {\n  const [loggedInUser, setLoggedInUser] = useState(null);\n  const [chatUser, setChatUser] = useState(null);\n  const [otherUsers, setOtherUsers] = useState([]);\n  const [messages, setMessages] = useState([]);\n  const [conversations, setConversations] = useState(null);\n  const [socket] = useState(() => io(':8000')); // GET USERS & LOGGED IN USER\n\n  useEffect(() => {\n    axios.get('http://localhost:8000/api/users', {\n      withCredentials: true\n    }).then(res => {\n      setLoggedInUser(res.data.loggedInUser);\n      setOtherUsers(res.data.otherUsers);\n    }).catch(err => navigate('/welcome'));\n    socket.on('received-newMessage', data => {\n      if (messages) {\n        setMessages(messages.concat([data.message]));\n      }\n    });\n  }, []); // GET MESSAGES\n\n  useEffect(() => {\n    if (loggedInUser) {\n      axios.get(`http://localhost:8000/api/messages/${loggedInUser._id}`, {\n        withCredentials: true\n      }).then(res => setMessages(res.data)).catch(err => console.log(err));\n    }\n  }, [loggedInUser]); // GET CONVERSATIONS\n\n  useEffect(() => {\n    if (messages.length > 0) {\n      let newMap = new Map();\n\n      for (let index = 0; index < messages.length; index++) {\n        const message = messages[index];\n\n        const userID = getRepresentationalUser(message)._id;\n\n        newMap.has(userID) ? newMap.set(userID, newMap.get(userID).concat([message])) : newMap.set(userID, [message]);\n      }\n\n      setConversations(newMap);\n    }\n  }, [messages]);\n\n  const logOut = () => {\n    axios.get('http://localhost:8000/api/users/logout', {\n      withCredentials: true\n    }).then(res => navigate('/')).catch(err => console.log(err));\n  };\n\n  const getRepresentationalUser = message => getUserById(message.receiverID === loggedInUser._id ? message.senderID : message.receiverID);\n\n  const getUserById = userID => otherUsers.filter(user => user._id === userID)[0]; // const displayTimeAgo = timestamp => {\n  //     const date = new Date(timestamp);\n  //     const moment = require('moment')(date);\n  //     return moment.fromNow();\n  // }\n\n\n  return React.createElement(\"div\", {\n    style: {\n      overflowY: 'auto'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81\n    },\n    __self: this\n  }, React.createElement(Navbar, {\n    style: {\n      backgroundColor: 'white'\n    },\n    className: \"py-3 px-4\",\n    expand: \"lg\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82\n    },\n    __self: this\n  }, React.createElement(\"h3\", {\n    className: \"p-0 m-0\",\n    href: \"#\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83\n    },\n    __self: this\n  }, \"Chazzy.\"), React.createElement(Navbar.Toggle, {\n    \"aria-controls\": \"nav-collapse\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84\n    },\n    __self: this\n  }), React.createElement(Navbar.Collapse, {\n    id: \"nav-collapse\",\n    className: \"ml-4\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85\n    },\n    __self: this\n  }, React.createElement(Nav, {\n    className: \"mr-auto align-middle\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86\n    },\n    __self: this\n  }, React.createElement(Nav.Link, {\n    className: \"align-middle mx-1\",\n    href: \"#\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }, loggedInUser ? loggedInUser.username : ''), React.createElement(Nav.Link, {\n    className: \"align-middle mx-1\",\n    href: \"#\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88\n    },\n    __self: this\n  }, \"Recents\")), React.createElement(Nav, {\n    className: \"ml-auto m-0 p-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  }, React.createElement(Nav.Link, {\n    onClick: logOut,\n    className: \"align-middle mx-1\",\n    href: \"#\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91\n    },\n    __self: this\n  }, \"Log Out.\")))), React.createElement(\"div\", {\n    className: `${styles.rowHeight} container-fluid m-0 p-0 w-100`,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }, React.createElement(Row, {\n    className: \"h-100 w-100 p-0 m-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96\n    },\n    __self: this\n  }, React.createElement(Col, {\n    style: {\n      backgroundImage: 'linear-gradient(white, rgb(245, 245, 245))'\n    },\n    className: \"h-100 w-100\",\n    md: 5,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, React.createElement(\"ul\", {\n    className: \"list-inline w-100 text-left p-3 m-0\",\n    style: {\n      overflowX: 'scroll'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }, otherUsers.map(otherUser => React.createElement(\"li\", {\n    key: otherUser._id,\n    className: \"list-inline-item mx-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  }, React.createElement(UserProfilePreview, {\n    onClick: () => setChatUser(otherUser),\n    user: otherUser,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101\n    },\n    __self: this\n  })))), React.createElement(\"ul\", {\n    className: \"list-inline w-100 p-3 m-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, React.createElement(\"h5\", {\n    className: \"mx-auto mb-3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, \"Hi \", loggedInUser ? loggedInUser.firstName : '', \"! You have (\", messages.length, \") messages.\")), React.createElement(\"li\", {\n    className: \"w-100 text-left\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }, React.createElement(\"ul\", {\n    className: \"list-inline\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    width: \"90\",\n    height: \"90\",\n    className: \"rounded-circle\",\n    src: Grey,\n    alt: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"d-inline-block\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, React.createElement(\"p\", {\n    className: \"m-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113\n    },\n    __self: this\n  }, \"First + Last\"), React.createElement(\"p\", {\n    className: \"m-0\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114\n    },\n    __self: this\n  }, \"message\"))))))), React.createElement(Col, {\n    className: \"p-3 h-100\",\n    md: 7,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(Context.Provider, {\n    value: {\n      loggedInUser\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }, chatUser ? React.createElement(ChatArea, {\n    userWhomAmChattingWith: chatUser,\n    passedInMessages: conversations.get(chatUser._id),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }) : React.createElement(React.Fragment, null))))));\n};\n\nexport default Dashboard;","map":{"version":3,"sources":["/Users/quangnguyen/Desktop/Projects/Chazzy/client/src/components/Dashboard.js"],"names":["React","useState","useEffect","useContext","navigate","axios","Context","io","UserProfilePreview","ChatArea","Navbar","Nav","Row","Col","styles","Grey","Dashboard","loggedInUser","setLoggedInUser","chatUser","setChatUser","otherUsers","setOtherUsers","messages","setMessages","conversations","setConversations","socket","get","withCredentials","then","res","data","catch","err","on","concat","message","_id","console","log","length","newMap","Map","index","userID","getRepresentationalUser","has","set","logOut","getUserById","receiverID","senderID","filter","user","overflowY","backgroundColor","username","rowHeight","backgroundImage","overflowX","map","otherUser","firstName"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport { navigate } from '@reach/router';\nimport axios from 'axios';\nimport Context from '../Context';\nimport io from 'socket.io-client';\n\n// Components\nimport UserProfilePreview from '../components/UserProfilePreview';\nimport ChatArea from '../components/ChatArea';\n\n// Bootstrap & Images\nimport { Navbar, Nav, Row, Col } from 'react-bootstrap';\nimport styles from './Dashboard.module.css';\nimport '../App.css';\nimport Grey from '../grey.jpg';\n\nconst Dashboard = () => {\n    const [loggedInUser, setLoggedInUser] = useState(null);\n    const [chatUser, setChatUser] = useState(null);\n    const [otherUsers, setOtherUsers] = useState([]);\n    const [messages, setMessages] = useState([]);\n    const [conversations, setConversations] = useState(null);\n    const [socket] = useState(() => io(':8000'));\n\n    // GET USERS & LOGGED IN USER\n    useEffect(() => {\n        axios.get('http://localhost:8000/api/users', { withCredentials: true })\n            .then(res => {\n                setLoggedInUser(res.data.loggedInUser);\n                setOtherUsers(res.data.otherUsers);\n            })\n            .catch(err => navigate('/welcome'));\n\n        socket.on('received-newMessage', data => {\n            if (messages) {\n                setMessages(messages.concat([data.message]));\n            }\n        });\n    }, []);\n\n    // GET MESSAGES\n    useEffect(() => {\n        if (loggedInUser) {\n            axios.get(`http://localhost:8000/api/messages/${loggedInUser._id}`, { withCredentials: true })\n                .then(res => setMessages(res.data))\n                .catch(err => console.log(err));\n        }\n    }, [loggedInUser]);\n\n    // GET CONVERSATIONS\n    useEffect(() => {\n        if (messages.length > 0) {\n            let newMap = new Map();\n\n            for (let index = 0; index < messages.length; index++) {\n                const message = messages[index];\n                const userID = getRepresentationalUser(message)._id;\n                newMap.has(userID) ? newMap.set(userID, newMap.get(userID).concat([message])) : newMap.set(userID, [message]);\n            }\n\n            setConversations(newMap);\n        }\n    }, [messages]);\n\n    const logOut = () => {\n        axios.get('http://localhost:8000/api/users/logout', { withCredentials: true })\n            .then(res => navigate('/'))\n            .catch(err => console.log(err));\n    }\n\n    const getRepresentationalUser = message => getUserById((message.receiverID === loggedInUser._id) ? message.senderID : message.receiverID);\n    const getUserById = userID => otherUsers.filter(user => user._id === userID)[0];\n\n    // const displayTimeAgo = timestamp => {\n    //     const date = new Date(timestamp);\n    //     const moment = require('moment')(date);\n    //     return moment.fromNow();\n    // }\n\n    return (\n        <div style={{ overflowY: 'auto' }}>\n            <Navbar style={{ backgroundColor: 'white' }} className=\"py-3 px-4\" expand=\"lg\">\n                <h3 className=\"p-0 m-0\" href=\"#\">Chazzy.</h3>\n                <Navbar.Toggle aria-controls=\"nav-collapse\" />\n                <Navbar.Collapse id=\"nav-collapse\" className=\"ml-4\">\n                    <Nav className=\"mr-auto align-middle\">\n                        <Nav.Link className=\"align-middle mx-1\" href=\"#\">{loggedInUser ? loggedInUser.username : ''}</Nav.Link>\n                        <Nav.Link className=\"align-middle mx-1\" href=\"#\">Recents</Nav.Link>\n                    </Nav>\n                    <Nav className=\"ml-auto m-0 p-0\">\n                        <Nav.Link onClick={logOut} className=\"align-middle mx-1\" href=\"#\">Log Out.</Nav.Link>\n                    </Nav>\n                </Navbar.Collapse>\n            </Navbar>\n            <div className={`${styles.rowHeight} container-fluid m-0 p-0 w-100`}>\n                <Row className=\"h-100 w-100 p-0 m-0\">\n                    <Col style={{ backgroundImage: 'linear-gradient(white, rgb(245, 245, 245))' }} className=\"h-100 w-100\" md={5}>\n                        <ul className=\"list-inline w-100 text-left p-3 m-0\" style={{ overflowX: 'scroll' }}>\n                            {otherUsers.map(otherUser => (\n                                <li key={otherUser._id} className=\"list-inline-item mx-2\">\n                                    <UserProfilePreview onClick={() => setChatUser(otherUser)} user={otherUser} />\n                                </li>\n                            ))}\n\n                        </ul>\n                        <ul className=\"list-inline w-100 p-3 m-0\">\n                            <li><h5 className=\"mx-auto mb-3\">Hi {loggedInUser ? loggedInUser.firstName : ''}! You have ({messages.length}) messages.</h5></li>\n                            <li className=\"w-100 text-left\">\n                                <ul className=\"list-inline\">\n                                    <li>\n                                        <img width=\"90\" height=\"90\" className=\"rounded-circle\" src={Grey} alt=\"\" /><br />\n                                        <div className=\"d-inline-block\">\n                                            <p className=\"m-0\">First + Last</p>\n                                            <p className=\"m-0\">message</p>\n                                        </div>\n                                    </li>\n                                </ul>\n                            </li>\n                        </ul>\n                    </Col>\n                    <Col className=\"p-3 h-100\" md={7}>\n                        <Context.Provider value={{ loggedInUser }}>\n                            {chatUser ? <ChatArea userWhomAmChattingWith={chatUser} passedInMessages={conversations.get(chatUser._id)} /> : <></>}\n                        </Context.Provider>\n                    </Col>\n                </Row>\n            </div>\n        </div >\n    )\n}\n\nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}